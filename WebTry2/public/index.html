<!DOCTYPE html>
<html>
  <head>
    <meta charset=utf-8 />
    <title>Contractor's Business Manager Homepage</title>

    <link rel='stylesheet' href='./stylesheets/main.css' media='screen and (orientation: landscape)'>
    <link rel='stylesheet' href='./stylesheets/mobile.css' media='screen and (orientation: portrait)'>

    <!-- Import and configure the Firebase SDK -->
    <script src="/__/firebase/5.3.0/firebase-app.js"></script>
    <script src="/__/firebase/5.3.0/firebase-auth.js"></script>
    <script src="/__/firebase/5.3.0/firebase-database.js"></script>
    <script src="/__/firebase/5.3.0/firebase-functions.js"></script>
    <script src="/__/firebase/init.js"></script>
  </head>
  <body>
    <div class='message'>
      <br/>
      <h1>Menu</h1>
      <div class='topnav'>
        <!-- NavBar -->
        <a href="./email-password.html">Sign In</a>
        <a href="./index.html">Menu</a>
        <a href="./count_hours.html">Count Hours</a>
      </div>
    </div>
    <br/><br/><br/>
   <!-- TO REMOVE AFTER TESTING -->
    <div>
      Firebase sign-in status: <span id="sign-in-status">Unknown</span>
      <div>Firebase auth <code>currentUser</code> object value:</div>
      <pre><code id="account-details">null</code></pre>
    </div>


  <!-- TO REMOVE AFTER TESTING-->
    <script type='text/javascript'>
      var setClaimsOnNewUser = firebase.functions().httpsCallable('setClaimsOnNewUser');
      var getUserClaims = firebase.functions().httpsCallable('getUserClaims');

      function initApp() {
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            var displayName = user.displayName;
            var email = user.email;
            var uid = user.uid;
            var providerData = user.providerData;

            document.getElementById('sign-in-status').textContent = 'Signed in';
            document.getElementById('account-details').textContent = 'Name: ' + displayName + '\nEmail: ' + email + '\nUID: ' + uid + '\nProvider Data: ' + providerData;

            getUserClaims({uid: user.uid})
              .then((result) => {
                console.log('getUserClaims success');
                console.log(result.data.business);
              })
              .catch((err) => {
                console.log('getUserClaims fail');
                console.log (err);
              });

      /*setClaimsOnNewUser({uid: user.uid, claims: {admin: true, business:'Rangel Enterpises Inc'}})
        .then (function (result) {
          console.log ('success');
        });*/

          } else {
            document.getElementById('sign-in-status').textContent = 'Signed out';
            document.getElementById('account-details').textContent = 'null';
          }
        })
      };

      window.onload = function() {
        initApp();
      };
    </script>
  </body>
</html>
